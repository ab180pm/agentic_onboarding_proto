%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e3f2fd', 'primaryTextColor': '#1565c0', 'primaryBorderColor': '#1976d2', 'lineColor': '#42a5f5', 'secondaryColor': '#fff3e0', 'tertiaryColor': '#f3e5f5'}}}%%
flowchart TD
    %% ===== START =====
    START([ğŸš€ Agentic Onboarding ì‹œì‘]) --> ENV_SELECT

    %% ===== PHASE 1: ENVIRONMENT & APP REGISTRATION =====
    subgraph ENV_SELECT[" ğŸŒ 1ë‹¨ê³„: í™˜ê²½ ì„ íƒ "]
        E1{í™˜ê²½ ì„ íƒ}
        E1 -->|Development| DEV_FLOW
        E1 -->|Production| PROD_FLOW
    end

    %% ===== DEVELOPMENT MODE FLOW =====
    subgraph DEV_FLOW[" ğŸ”§ Development Mode "]
        direction TB
        D1[ì•± ì´ë¦„ ì…ë ¥<br/>ì˜ì†Œë¬¸ì + ìˆ«ìë§Œ]
        D2[í”Œë«í¼ ì„ íƒ<br/>iOS / Android / Web]
        D3[íƒ€ì„ì¡´ & í†µí™” í™•ì¸<br/>ìë™ ê°ì§€ ë˜ëŠ” ìˆ˜ë™ ì„¤ì •]
        D4[í† í° ë°œê¸‰ ì™„ë£Œ<br/>App SDK Token<br/>Web SDK Token<br/>API Token]

        D1 --> D2 --> D3 --> D4
    end

    %% ===== PRODUCTION MODE FLOW =====
    subgraph PROD_FLOW[" ğŸš€ Production Mode "]
        direction TB
        P1[í”Œë«í¼ ì„ íƒ<br/>iOS / Android / Web<br/>ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥]
        P2[í”Œë«í¼ë³„ ì•± ë“±ë¡<br/>ìŠ¤í† ì–´ ê²€ìƒ‰ ë˜ëŠ” URL ì…ë ¥]
        P3[ì•± ì •ë³´ í™•ì¸<br/>Bundle ID / Package Name]
        P4[íƒ€ì„ì¡´ & í†µí™” ì„¤ì •]
        P5[í† í° ë°œê¸‰ ì™„ë£Œ]

        P1 --> P2 --> P3 --> P4 --> P5
    end

    %% ===== CONVERGE TO SDK SETUP =====
    DEV_FLOW --> SDK_CHOICE
    PROD_FLOW --> SDK_CHOICE

    %% ===== PHASE 2: SDK INSTALLATION =====
    subgraph SDK_CHOICE[" ğŸ“¦ 2ë‹¨ê³„: SDK ì„¤ì¹˜ ë°©ì‹ ì„ íƒ "]
        S1{ì„¤ì¹˜ ì£¼ì²´ ì„ íƒ}
        S1 -->|ì§ì ‘ ì„¤ì¹˜| SDK_METHOD
        S1 -->|ê°œë°œìì—ê²Œ ê³µìœ | SDK_SHARE[ì„¤ì¹˜ ê°€ì´ë“œ ê³µìœ <br/>Slack/Email]
    end

    subgraph SDK_METHOD[" âš™ï¸ ì„¤ì¹˜ ë°©ë²• ì„ íƒ "]
        SM1{ë°©ë²• ì„ íƒ}
        SM1 -->|GitHub Automation| GH_AUTO
        SM1 -->|Manual| FRAMEWORK_SELECT
    end

    %% ===== GITHUB AUTOMATION PATH =====
    subgraph GH_AUTO[" ğŸ”„ GitHub Automation "]
        direction TB
        GH1[GitHub ì—°ê²°<br/>OAuth ì¸ì¦]
        GH2[Repository ì„ íƒ]
        GH3[ê¶Œí•œ ë¶€ì—¬<br/>Write Access]
        GH4[ìë™ PR ìƒì„±<br/>SDK Install â†’ Init â†’ Deeplink â†’ Events]

        GH1 --> GH2 --> GH3 --> GH4
    end

    %% ===== FRAMEWORK SELECTION =====
    subgraph FRAMEWORK_SELECT[" ğŸ› ï¸ Framework ì„ íƒ "]
        FS1{Framework}
        FS1 -->|iOS Native| IOS_SDK
        FS1 -->|Android Native| ANDROID_SDK
        FS1 -->|Web Only| WEB_SDK
        FS1 -->|React Native| CROSS_SDK
        FS1 -->|Flutter| CROSS_SDK
        FS1 -->|Unity| CROSS_SDK
        FS1 -->|Expo| CROSS_SDK
    end

    %% ===== iOS NATIVE SDK =====
    subgraph IOS_SDK[" ğŸ iOS Native SDK "]
        direction TB
        I1[SDK ì„¤ì¹˜<br/>CocoaPods / SPM]
        I2[SDK ì´ˆê¸°í™”<br/>AppDelegate ì„¤ì •]
        I3[ë”¥ë§í¬ ì„¤ì •<br/>Associated Domains<br/>URL Types]

        I1 --> I2 --> I3
    end

    %% ===== ANDROID NATIVE SDK =====
    subgraph ANDROID_SDK[" ğŸ¤– Android Native SDK "]
        direction TB
        A1[SDK ì„¤ì¹˜<br/>Gradle ì˜ì¡´ì„±]
        A2[SDK ì´ˆê¸°í™”<br/>Application class]
        A3[ë”¥ë§í¬ ì„¤ì •<br/>Intent Filters<br/>App Links]

        A1 --> A2 --> A3
    end

    %% ===== WEB SDK =====
    subgraph WEB_SDK[" ğŸŒ Web SDK "]
        direction TB
        W1[ì„¤ì¹˜ ë°©ë²• ì„ íƒ<br/>Script íƒœê·¸ / NPM]
        W2[SDK ì´ˆê¸°í™”<br/>Web Token ì„¤ì •]
        W3[ì˜µì…˜ ì„¤ì •<br/>UTM / Cookie / Attribution]

        W1 --> W2 --> W3
    end

    %% ===== CROSS PLATFORM SDK =====
    subgraph CROSS_SDK[" âš›ï¸ Cross-Platform SDK "]
        direction TB
        C1[íŒ¨í‚¤ì§€ ì„¤ì¹˜<br/>npm / pub / unitypackage]
        C2[ë„¤ì´í‹°ë¸Œ ì„¤ì •<br/>iOS + Android ê°ê°]
        C3[SDK ì´ˆê¸°í™” ì½”ë“œ<br/>ì•± ì§„ì…ì ì— ì¶”ê°€]
        C4[ë”¥ë§í¬ ì„¤ì •<br/>ì–‘ í”Œë«í¼ ì„¤ì •]

        C1 --> C2 --> C3 --> C4
    end

    %% ===== CONVERGE TO SDK TEST =====
    IOS_SDK --> SDK_TEST
    ANDROID_SDK --> SDK_TEST
    WEB_SDK --> SDK_TEST
    CROSS_SDK --> SDK_TEST
    GH_AUTO --> SDK_TEST

    %% ===== PHASE 3: SDK TEST =====
    subgraph SDK_TEST[" ğŸ§ª 3ë‹¨ê³„: SDK í…ŒìŠ¤íŠ¸ "]
        direction TB
        T1[í…ŒìŠ¤íŠ¸ ì‹¤í–‰<br/>Install í™•ì¸<br/>Init í™•ì¸<br/>Event ì „ì†¡ í™•ì¸]
        T2{í…ŒìŠ¤íŠ¸ ê²°ê³¼}
        T2 -->|ì„±ê³µ| T_PASS[SDK ì—°ë™ ì™„ë£Œ âœ…]
        T2 -->|ì‹¤íŒ¨| T_FAIL[íŠ¸ëŸ¬ë¸”ìŠˆíŒ…<br/>ë””ë²„ê·¸ ê°€ì´ë“œ]

        T1 --> T2
        T_FAIL --> T1
    end

    %% ===== DEV vs PROD DIVERGE =====
    T_PASS --> MODE_CHECK

    subgraph MODE_CHECK[" ğŸ“‹ ëª¨ë“œë³„ ë¶„ê¸° "]
        MC1{í˜„ì¬ ëª¨ë“œ}
        MC1 -->|Development| DEV_COMPLETE
        MC1 -->|Production| PROD_CONTINUE
    end

    %% ===== DEVELOPMENT COMPLETE =====
    subgraph DEV_COMPLETE[" ğŸ‰ Development ì™„ë£Œ "]
        DC1[SDK í…ŒìŠ¤íŠ¸ ì™„ë£Œ!<br/>Development í™˜ê²½ ì¤€ë¹„ë¨]
        DC2[Real-time Logsì—ì„œ<br/>ì´ë²¤íŠ¸ í™•ì¸ ê°€ëŠ¥]
        DC3{ë‹¤ìŒ ë‹¨ê³„}
        DC3 -->|Production ì•± ì¶”ê°€| PROD_FLOW
        DC3 -->|ì¢…ë£Œ| COMPLETE_DEV

        DC1 --> DC2 --> DC3
    end

    %% ===== PRODUCTION CONTINUE =====
    subgraph PROD_CONTINUE[" ğŸ“ˆ Production ì¶”ê°€ ì„¤ì • "]
        direction TB
        PC1[Event Taxonomy ì„¤ì •<br/>Standard Events<br/>Custom Events]
    end

    PROD_CONTINUE --> CHANNEL_INT

    %% ===== PHASE 4: CHANNEL INTEGRATION (Production Only) =====
    subgraph CHANNEL_INT[" ğŸ“º 4ë‹¨ê³„: ì±„ë„ ì—°ë™ "]
        direction TB
        CH1[ì±„ë„ ì„ íƒ<br/>Meta / Google / Apple / TikTok]
        CH2[ì±„ë„ë³„ ì—°ë™<br/>OAuth ì¸ì¦]
        CH3[Cost ì—°ë™<br/>ê´‘ê³  ë¹„ìš© ë°ì´í„°]
        CH4[SKAN ì„¤ì •<br/>iOS í”„ë¼ì´ë²„ì‹œ]

        CH1 --> CH2 --> CH3 --> CH4
    end

    CHANNEL_INT --> VERIFICATION

    %% ===== PHASE 5: VERIFICATION (Production Only) =====
    subgraph VERIFICATION[" âœ… 5ë‹¨ê³„: ê²€ì¦ "]
        direction TB
        V1[íŠ¸ë˜í‚¹ ë§í¬ ìƒì„±]
        V2[ë”¥ë§í¬ í…ŒìŠ¤íŠ¸<br/>ì•± ì„¤ì¹˜ë¨ / ë¯¸ì„¤ì¹˜]
        V3[ì–´íŠ¸ë¦¬ë·°ì…˜ í…ŒìŠ¤íŠ¸<br/>í´ë¦­ â†’ ì „í™˜ í™•ì¸]
        V4[ë°ì´í„° ê²€ì¦<br/>ëŒ€ì‹œë³´ë“œ í™•ì¸]

        V1 --> V2 --> V3 --> V4
    end

    VERIFICATION --> COMPLETE_PROD

    %% ===== END =====
    COMPLETE_DEV([ğŸ”§ Development ì„¤ì • ì™„ë£Œ])
    COMPLETE_PROD([ğŸš€ Production ì˜¨ë³´ë”© ì™„ë£Œ])

    %% ===== STYLING =====
    classDef devMode fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef prodMode fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef sdkStep fill:#fff3e0,stroke:#f57f17,stroke-width:1px
    classDef testStep fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    classDef channelStep fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    classDef complete fill:#c8e6c9,stroke:#388e3c,stroke-width:2px

    class DEV_FLOW,DEV_COMPLETE devMode
    class PROD_FLOW,PROD_CONTINUE,CHANNEL_INT,VERIFICATION prodMode
    class SDK_CHOICE,SDK_METHOD,FRAMEWORK_SELECT,IOS_SDK,ANDROID_SDK,WEB_SDK,CROSS_SDK sdkStep
    class SDK_TEST testStep
    class COMPLETE_DEV,COMPLETE_PROD complete
